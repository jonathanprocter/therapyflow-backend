# Immediate Actions Checklist

## ‚úÖ Completed
- [x] Fixed Google Calendar OAuth code to support Render.com
- [x] Created database user setup script
- [x] Committed and pushed changes to GitHub
- [x] Render will auto-deploy the updated code

---

## ‚ö†Ô∏è YOU MUST DO THESE STEPS NOW

### Step 1: Set Environment Variable in Render (2 minutes)

1. Go to: https://dashboard.render.com
2. Click on your `therapyflow-api` service
3. Click **Environment** tab
4. Click **Add Environment Variable**
5. Add:
   ```
   Key: RENDER_EXTERNAL_URL
   Value: https://therapyflow-api.onrender.com
   ```
   *(Replace with your actual Render service URL)*
6. Click **Save Changes**
7. Wait for auto-deploy to complete

---

### Step 2: Update Google Cloud Console (3 minutes)

1. Go to: https://console.cloud.google.com/apis/credentials
2. Select your OAuth 2.0 Client ID
3. Under **Authorized redirect URIs**, click **+ ADD URI**
4. Add:
   ```
   https://therapyflow-api.onrender.com/api/calendar/callback
   ```
   *(Replace with your actual Render service URL)*
5. Click **Save**

---

### Step 3: Create Database User (5 minutes)

#### Option A: Using Render Shell (Easiest)

1. Go to Render Dashboard ‚Üí Your Service ‚Üí **Shell** tab
2. Run:
   ```bash
   tsx scripts/setup-database-user.ts "YourSecurePassword123"
   ```
3. You should see: ‚úÖ User created successfully!

#### Option B: Using Local Connection

1. Get your DATABASE_URL from Render Dashboard ‚Üí Environment
2. On your local machine:
   ```bash
   export DATABASE_URL="your-database-url-from-render"
   cd therapyflow-backend
   tsx scripts/setup-database-user.ts "YourSecurePassword123"
   ```

---

### Step 4: Re-authenticate Google Calendar (3 minutes)

1. After Render finishes deploying, visit:
   ```
   https://therapyflow-api.onrender.com/api/calendar/auth
   ```
   *(Replace with your actual URL)*

2. Click through Google OAuth consent screen

3. After redirect, check Render logs:
   - Go to Render Dashboard ‚Üí Your Service ‚Üí **Logs** tab
   - Look for: "üí° IMPORTANT: Save this refresh token..."
   - Copy the long token that starts with `1//0`

4. Add the refresh token to Render:
   - Go to **Environment** tab
   - Click **Add Environment Variable**
   - Add:
     ```
     Key: GOOGLE_REFRESH_TOKEN
     Value: 1//0xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
     ```
   - Click **Save Changes**

---

### Step 5: Verify Everything Works (2 minutes)

1. **Check Health Endpoint**:
   ```bash
   curl https://therapyflow-api.onrender.com/api/health
   ```
   Should return: `{"ok": true, ...}`

2. **Check Logs**:
   - Go to Render Dashboard ‚Üí Logs
   - Should NOT see "demo mode" or "Error 400"
   - Should see: "Using OAuth2 redirect URI: https://therapyflow-api.onrender.com/..."

3. **Test Your App**:
   - Open your app in browser
   - Should load with real data (not demo mode)
   - Calendar sync should work without Error 400

---

## Environment Variables Checklist

Make sure ALL of these are set in Render Dashboard ‚Üí Environment:

- [ ] `DATABASE_URL` (auto-set by Render)
- [ ] `GOOGLE_CLIENT_ID` (from Google Cloud Console)
- [ ] `GOOGLE_CLIENT_SECRET` (from Google Cloud Console)
- [ ] `GOOGLE_REFRESH_TOKEN` (generated after Step 4)
- [ ] `RENDER_EXTERNAL_URL` (your Render app URL)
- [ ] `ANTHROPIC_API_KEY` (your Anthropic API key)
- [ ] `SESSION_SECRET` (auto-generated by Render)
- [ ] `NODE_ENV=production`

---

## Troubleshooting

### "Still in demo mode"
- Check if database user was created: Run `SELECT * FROM users WHERE id = 'dr-jonathan-procter';`
- Check Render logs for database connection errors

### "Still getting Error 400"
- Verify RENDER_EXTERNAL_URL is set correctly
- Verify Google Cloud Console redirect URI matches exactly
- Try clearing browser cache and re-authenticating

### "Can't run setup script"
- Make sure you're in the Render shell or have DATABASE_URL set locally
- Check that the script file exists: `ls scripts/setup-database-user.ts`
- Try: `npm install tsx` if tsx command not found

---

## Summary

**What was fixed in the code:**
1. ‚úÖ Google Calendar OAuth now supports Render.com
2. ‚úÖ Added automated database user setup script
3. ‚úÖ Better error messages for debugging

**What you need to do:**
1. ‚ö†Ô∏è Set RENDER_EXTERNAL_URL environment variable
2. ‚ö†Ô∏è Update Google Cloud Console redirect URI
3. ‚ö†Ô∏è Run database setup script to create user
4. ‚ö†Ô∏è Re-authenticate Google Calendar
5. ‚ö†Ô∏è Set GOOGLE_REFRESH_TOKEN environment variable

**Expected result:**
- ‚úÖ App loads with real data (no demo mode)
- ‚úÖ Google Calendar syncs without Error 400
- ‚úÖ All features work properly

---

## Questions?

If something doesn't work:
1. Check Render logs for specific errors
2. Verify all environment variables are set
3. Make sure database user exists
4. Confirm Google Cloud Console configuration

**Total time to complete: ~15 minutes**

---

**Your Render Service URL**: `https://therapyflow-api.onrender.com`
*(Replace this with your actual URL throughout this checklist)*
